#!/usr/bin/env bash
#    _____ _     ____  ____  ____  ____  _____
#   /    // \   /  _ \/  __\/  _ \/  __\/__ __\
#   |  __\| |   | / \||  \/|| / \||  \/|  / \
#   | |   | |_/\| |-|||  __/| \_/||    /  | |
#   \_/   \____/\_/ \|\_/   \____/\_/\_\  \_/

# ---------------------------------------------------- #
# !!! NOTE THAT THIS SCRIPT SHOULD NOT BE SOURCED. !!! #
# ---------------------------------------------------- #

# last complete install: 2021.10.21

## checks
#-------------------------------------------------------------------------------

## pre-installation checks
if [ "$USER" == root ]; then
    echo
    echo "'python_install' should NOT be run as root, nor should it be run with sudo."
    echo "this script should be run [normally] by a user with sudo privileges."
    exit 1
fi

if [[ "${BASH_SOURCE[0]}" != "${0}" ]]; then
    echo
    echo "'python_install' should NOT be sourced."
    exit 1
fi


## anaconda python
#-------------------------------------------------------------------------------

CONDAROOT="$HOME/.anaconda"

if [ ! -d "$CONDAROOT" ]; then
    printf "installing anaconda python at %s... " "$CONDAROOT"
    cd "$HOME" || exit 1
    curl -L https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-x86_64.sh --output /tmp/miniconda.sh --silent
    bash /tmp/miniconda.sh -b -p "$CONDAROOT"
    rm /tmp/miniconda.sh
    echo "installed."
fi

source "$CONDAROOT/etc/profile.d/conda.sh"


## base environment
#-------------------------------------------------------------------------------

mamba install -y -n base altair black bokeh build bump2version ca-certificates certifi \
coverage cython dvc-s3 fastcore fire flake8 flax gdspy git graphviz grayskull \
greenlet h5py ipykernel ipympl ipywidgets isort jax jaxlib jinja2 jupyterhub \
jupyterlab jupyterlab-lsp jupyterlab_code_formatter jupyterlab_vim line_profiler \
lxml make matplotlib mypy natsort nbdev nbdime nbsphinx nbstripout networkx nodejs \
numpy openpyxl openssh openssl pandas pandoc papermill patch pep8 pillow pip plotly \
pre-commit pybind11 pydocstyle pyflakes pygraphviz pylint pynvim pyright pytables \
pytest pytest-order pytest-timeout python python-graphviz pyyaml scikit-learn scipy \
setuptools shapely sphinx sphinx-autodoc-typehints sphinx_rtd_theme suitesparse \
sympy tensorflow tqdm twine watchdog wheel xlrd xmltodict yapf

$CONDAROOT/bin/python -m ipykernel install --user --name base --display-name base
$CONDAROOT/bin/jupyter labextension install @arbennett/base16-nord
